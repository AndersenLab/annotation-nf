/*
    Rockfish Configuration
*/

params {
    base_dir = '/vast/eande106'
    data_dir = '/vast/eande106/data'
}

process {
    executor = 'slurm'
    queueSize = 100
    clusterOptions = '-A eande106 -e errlog.txt -N 1'
    cpus = 1
    time = "1.hour"
    queue = "parallel"

    withName: "LOCAL.*" {
        executor = "local"
        container = null
    }

    withName: "BCFTOOLS.*" {
        container = 'docker://quay.io/biocontainers/bcftools:1.16--hfe4b78e_1'
    }

    withName: "BEDTOOLS.*" {
        container = 'docker://quay.io/biocontainers/bedtools:2.31.1--h13024bc_3'
    }
    
    withName: "PERL_.*" {
        container = 'docker://andersenlab/annovar:20251009'
    }

    withName: "VEP_.*" {
        container = 'docker://ensemblorg/ensembl-vep:release_115.2'
    }

    withName: "JAVA_.*" {
        container = 'docker://quay.io/biocontainers/snpeff:5.3.0a--hdfd78af_1'
    }

    withName: "PYTHON_.*" {
        container = "andersenlab/numpy:20250224"
    }

    withName: "BEDTOOLS_HDR_ANNOTATIONS" {
        array = 1000
    }

    withLabel: parse_samples {
        errorStrategy='retry'
        maxRetries=2
    }
    
    withLabel: R {
        container = "andersenlab/r_packages:v0.7"
    }

    withLabel: annotation {
        container = "andersenlab/annotation:202203071920250e7671"
    }
    
    withLabel: snpeff {
        container = "andersenlab/annotation:202203071920250e7671"
    }
    withLabel: parse_samples {
        container = "andersenlab/r_packages:v0.7"
    }

    withLabel: ".*mid.*" {
        time = "4.hour"
    }

    withLabel: ".*long.*" {
        time = "24.hour"
    }

    withLabel: ".*extended.*" {
        time = "48.hour"
    }

    withLabel: ".*xs.*" {
        cpus = 1
    }

    withLabel: ".*sm.*" {
        cpus = 2
    }

    withLabel: ".*md.*" {
        cpus = 4
    }

    withLabel: ".*ml.*" {
        cpus = 16
    }

    withLabel: ".*lg.*" {
        cpus = 24
    }

    withLabel: ".*xl.*" {
        cpus = 48
    }

    withLabel: ".*mem.*" {
        clusterOptions = '-A eande106_bigmem -e errlog.txt -N 1'
        cpus = 8
        queue = "bigmem"
    }

}

executor {
    queueSize=500
    submitRateLimit=10
}

singularity {
    enabled = true
    autoMounts = true
    cacheDir = "${params.base_dir}/singularity"
    pullTimeout = '20 min'
}

workflow {
    workDir = "/scratch4/eande106"
}


